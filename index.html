<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueLine Estates | –°–∏—Å—Ç–µ–º–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <style>
        :root {
            --primary-blue: #1a3a5f;
            --dark-blue: #0a1a2d;
            --accent-blue: #4a90e2;
            --light-blue: #a0c8ff;
            --success: #4cd964;
            --danger: #e74c3c;
            --warning: #f39c12;
            --elite: #9b59b6;
            --good: #2ecc71;
            --poor: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--dark-blue);
            color: #e0e0e0;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .card {
            background-color: #152642;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--primary-blue);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #c0392b, #e74c3c);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(90deg, #d35400, #f39c12);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            background-color: #1a3a5f;
            border: 1px solid #2a5c9a;
            border-radius: 6px;
            color: white;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        .hidden {
            display: none !important;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .navbar {
            background: linear-gradient(90deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #2a5c9a;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-img {
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, var(--accent-blue), var(--primary-blue));
            border-radius: 50%;
            border: 2px solid #2a5c9a;
        }
        
        .logo-text h1 {
            color: var(--accent-blue);
            font-size: 1.8rem;
            letter-spacing: 1px;
        }
        
        .logo-text p {
            font-size: 0.9rem;
            color: var(--light-blue);
        }
        
        .user-info {
            text-align: right;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid var(--accent-blue);
        }
        
        .badge {
            background-color: var(--primary-blue);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 5px;
        }
        
        .cash {
            font-size: 1.5rem;
            color: var(--success);
            font-weight: bold;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-links .btn {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        /* –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–≤—Ö–æ–¥–∞ */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }
        
        .auth-box {
            width: 100%;
            max-width: 400px;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-blue);
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            color: var(--light-blue);
            font-size: 1.1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .auth-tab.active {
            color: var(--accent-blue);
            border-bottom-color: var(--accent-blue);
            font-weight: bold;
        }
        
        /* –°–ø–∏—Å–æ–∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ */
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--light-blue);
            font-weight: 600;
        }
        
        .price-display {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.9rem;
            color: var(--light-blue);
        }
        
        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .property-card {
            background-color: #152642;
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid #2a5c9a;
            height: 100%;
        }
        
        .property-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            border-color: var(--accent-blue);
        }
        
        .property-image {
            height: 200px;
            width: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
            transition: transform 0.3s;
        }
        
        .property-card:hover .property-image {
            transform: scale(1.05);
        }
        
        .district-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8rem;
            background-color: var(--danger);
            z-index: 2;
        }
        
        .district-poor { background-color: var(--poor); }
        .district-good { background-color: var(--good); }
        .district-elite { background-color: var(--elite); }
        
        .property-info {
            padding: 20px;
        }
        
        .property-type {
            color: var(--accent-blue);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .property-title {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: white;
        }
        
        .property-description {
            color: #b0b0b0;
            margin-bottom: 20px;
            font-size: 0.95rem;
            min-height: 60px;
            line-height: 1.5;
        }
        
        .property-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            border-top: 1px solid #2a5c9a;
            border-bottom: 1px solid #2a5c9a;
            padding: 15px 0;
        }
        
        .detail {
            text-align: center;
        }
        
        .detail-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
        }
        
        .detail-label {
            font-size: 0.8rem;
            color: var(--light-blue);
        }
        
        .property-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .property-price {
            font-size: 1.8rem;
            color: var(--success);
            font-weight: bold;
        }
        
        .buy-btn {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            border: none;
        }
        
        .buy-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            padding: 20px;
        }
        
        .modal-content {
            background-color: #152642;
            width: 90%;
            max-width: 500px;
            border-radius: 12px;
            padding: 30px;
            border: 2px solid var(--accent-blue);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-wide {
            max-width: 800px;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2rem;
            color: var(--light-blue);
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            z-index: 1;
        }
        
        .modal h2 {
            color: var(--accent-blue);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .purchase-details {
            background-color: #1a3a5f;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #2a5c9a;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        /* –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å */
        .admin-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .admin-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-blue);
            flex-wrap: wrap;
        }
        
        .admin-tab {
            padding: 12px 25px;
            background: none;
            border: none;
            color: var(--light-blue);
            font-size: 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }
        
        .admin-tab.active {
            color: var(--accent-blue);
            border-bottom-color: var(--accent-blue);
            font-weight: bold;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .users-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }
        
        .user-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info-column {
            flex: 2;
        }
        
        .user-actions {
            flex: 1;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .balance-control {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .balance-input {
            width: 150px;
            padding: 8px;
        }
        
        .update-balance-btn {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é */
        .property-management {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .property-list {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .property-list-item {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .property-list-item:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-blue);
        }
        
        .property-list-item.active {
            background: rgba(74, 144, 226, 0.2);
            border-color: var(--accent-blue);
        }
        
        .property-form {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 8px;
        }
        
        .image-upload {
            border: 2px dashed #4a90e2;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(74, 144, 226, 0.1);
        }
        
        .image-upload:hover {
            background: rgba(74, 144, 226, 0.2);
        }
        
        .image-upload input {
            display: none;
        }
        
        .image-preview {
            margin-top: 15px;
            border-radius: 6px;
            overflow: hidden;
            max-height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 6px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        /* –ú–æ—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å */
        .owned-properties {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .owned-card {
            background: linear-gradient(135deg, rgba(42, 92, 154, 0.3), rgba(26, 58, 95, 0.3));
            border: 1px solid var(--accent-blue);
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
        }
        
        .notification.success { background-color: var(--success); }
        .notification.error { background-color: var(--danger); }
        .notification.warning { background-color: var(--warning); }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sync-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #666;
        }
        
        .sync-indicator.syncing { background-color: #f39c12; animation: pulse 1s infinite; }
        .sync-indicator.synced { background-color: #2ecc71; }
        .sync-indicator.error { background-color: #e74c3c; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* –§—É—Ç–µ—Ä */
        footer {
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            border-top: 1px solid #2a5c9a;
            color: var(--light-blue);
            font-size: 0.9rem;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .properties-grid {
                grid-template-columns: 1fr;
            }
            
            .user-item {
                flex-direction: column;
                gap: 15px;
            }
            
            .user-actions {
                width: 100%;
                justify-content: center;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .property-management {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .admin-tabs {
                overflow-x: auto;
            }
        }
        
        /* –ì–∞–ª–µ—Ä–µ—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –ø–æ–∫—É–ø–∫–∏ */
        .property-gallery {
            position: relative;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            height: 300px;
        }
        
        .gallery-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.5s;
        }
        
        .gallery-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            transform: translateY(-50%);
        }
        
        .gallery-btn {
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .gallery-dots {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .gallery-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            border: none;
        }
        
        .gallery-dot.active {
            background: var(--accent-blue);
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar" id="navbar">
        <div class="logo">
            <div class="logo-img"></div>
            <div class="logo-text">
                <h1>BlueLine Estates</h1>
                <p>–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
            </div>
        </div>
        <div class="user-info hidden" id="userInfo">
            <div class="badge" id="userBadge">–û—Ñ–∏—Ü–µ—Ä</div>
            <div class="cash" id="userCash">$0</div>
            <div>–í–∞—à –±–∞–ª–∞–Ω—Å</div>
        </div>
        <div class="nav-links hidden" id="navLinks">
            <button class="btn btn-primary" onclick="showPage('main')">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</button>
            <button class="btn btn-primary" onclick="showPage('myProperties')">–ú–æ—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</button>
            <button class="btn btn-danger" onclick="logout()">–í—ã–π—Ç–∏</button>
            <!-- –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞ -->
            <button class="btn btn-warning hidden" id="adminNavButton" onclick="showAdminPanel()">‚öôÔ∏è –ê–¥–º–∏–Ω</button>
        </div>
    </nav>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü -->
    <div class="container">
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–≤—Ö–æ–¥–∞ -->
        <div id="authPage" class="auth-container">
            <div class="auth-box card">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')">–í—Ö–æ–¥</button>
                    <button class="auth-tab" onclick="switchAuthTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </div>
                
                <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
                <div id="loginForm">
                    <h2 style="color: var(--accent-blue); margin-bottom: 20px; text-align: center;">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
                    <input type="text" id="loginUsername" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
                    <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
                    <button class="btn btn-primary" onclick="login()" style="width: 100%;">–í–æ–π—Ç–∏</button>
                    
                    <!-- –°–µ–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞ -->
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <input type="password" id="adminSecretCode" placeholder="–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)" 
                               style="background: rgba(0,0,0,0.3); border-color: #9b59b6; display: none;">
                    </div>
                    
                    <!-- –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <label style="color: var(--light-blue); display: block; margin-bottom: 8px;">–†–µ–∂–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:</label>
                        <select id="syncMode">
                            <option value="online">–û–Ω–ª–∞–π–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                            <option value="offline">–¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ</option>
                        </select>
                    </div>
                </div>
                
                <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                <div id="registerForm" class="hidden">
                    <h2 style="color: var(--accent-blue); margin-bottom: 20px; text-align: center;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                    <input type="text" id="regFirstName" placeholder="–ò–º—è" required>
                    <input type="text" id="regLastName" placeholder="–§–∞–º–∏–ª–∏—è" required>
                    <input type="text" id="regUsername" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
                    <input type="password" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
                    <input type="password" id="regConfirmPassword" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                    <button class="btn btn-success" onclick="register()" style="width: 100%;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </div>
            </div>
        </div>

        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å) -->
        <div id="mainPage" class="hidden">
            <h1 style="color: var(--accent-blue); margin-bottom: 30px;">–î–æ—Å—Ç—É–ø–Ω–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</h1>
            
            <div class="filters card">
                <div class="filter-group">
                    <label>–†–∞–π–æ–Ω</label>
                    <select id="districtFilter">
                        <option value="all">–í—Å–µ —Ä–∞–π–æ–Ω—ã</option>
                        <option value="poor">–ë–µ–¥–Ω—ã–µ —Ä–∞–π–æ–Ω—ã</option>
                        <option value="good">–•–æ—Ä–æ—à–∏–µ —Ä–∞–π–æ–Ω—ã</option>
                        <option value="elite">–≠–ª–∏—Ç–Ω—ã–µ —Ä–∞–π–æ–Ω—ã</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>–¢–∏–ø –∂–∏–ª—å—è</label>
                    <select id="typeFilter">
                        <option value="all">–õ—é–±–æ–µ –∂–∏–ª—å—ë</option>
                        <option value="apartment">–ö–≤–∞—Ä—Ç–∏—Ä—ã</option>
                        <option value="house">–î–æ–º–∞</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>–¶–µ–Ω–∞, $</label>
                    <input type="range" id="priceSlider" min="0" max="5000000" value="5000000" class="price-range">
                    <div class="price-display">
                        <span>$0</span>
                        <span id="maxPrice">$5,000,000</span>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="applyFilters()" style="align-self: end;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            </div>
            
            <div class="properties-grid" id="propertiesContainer">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ú–æ—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å" -->
        <div id="myPropertiesPage" class="hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
                <h1 style="color: var(--accent-blue);">–ú–æ—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</h1>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-warning" onclick="exportUserData()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                    <button class="btn btn-primary" onclick="importUserData()">üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                </div>
            </div>
            
            <div class="card" style="margin-bottom: 30px;">
                <h2 style="color: var(--accent-blue); margin-bottom: 15px;">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div>
                        <div style="color: var(--light-blue);">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤</div>
                        <div style="font-size: 2rem; color: var(--success); font-weight: bold;" id="totalAssets">$0</div>
                    </div>
                    <div>
                        <div style="color: var(--light-blue);">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ</div>
                        <div style="font-size: 2rem; color: var(--accent-blue); font-weight: bold;" id="propertyCount">0</div>
                    </div>
                    <div>
                        <div style="color: var(--light-blue);">–û–±—â–∏–π –¥–æ—Ö–æ–¥ –æ—Ç –∞—Ä–µ–Ω–¥—ã</div>
                        <div style="font-size: 2rem; color: var(--success); font-weight: bold;" id="rentalIncome">$0/–Ω–µ–¥–µ–ª—è</div>
                    </div>
                </div>
            </div>
            
            <h2 style="color: var(--accent-blue); margin-bottom: 20px;">–ö—É–ø–ª–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã</h2>
            <div class="owned-properties" id="ownedPropertiesContainer">
                <!-- –ö—É–ø–ª–µ–Ω–Ω–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                <div class="card" style="text-align: center; padding: 40px; color: var(--light-blue);">
                    <p style="font-size: 1.2rem;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</p>
                    <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å" —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É</p>
                    <button class="btn btn-primary" onclick="showPage('main')" style="margin-top: 20px;">–°–º–æ—Ç—Ä–µ—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
        <div id="adminPage" class="hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h1 style="color: var(--accent-blue);">‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</h1>
                <button class="btn btn-primary" onclick="showPage('main')">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∏–≥—Ä—É</button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ -->
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchAdminTab('users')">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                <button class="admin-tab" onclick="switchAdminTab('properties')">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é</button>
                <button class="admin-tab" onclick="switchAdminTab('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                <button class="admin-tab" onclick="switchAdminTab('actions')">–î–µ–π—Å—Ç–≤–∏—è</button>
                <button class="admin-tab" onclick="switchAdminTab('sync')">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            <div id="adminTabUsers" class="admin-section">
                <h2 style="color: var(--accent-blue); margin-bottom: 20px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                
                <div class="balance-control" style="margin-bottom: 20px;">
                    <input type="text" id="searchUser" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –ª–æ–≥–∏–Ω—É" onkeyup="searchUsers()">
                </div>
                
                <div class="users-list" id="usersList">
                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é -->
            <div id="adminTabProperties" class="admin-section hidden">
                <h2 style="color: var(--accent-blue); margin-bottom: 20px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é</h2>
                <p style="color: var(--light-blue); margin-bottom: 20px;">–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –∏–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏. –ò–≥—Ä–æ–∫–∏ —É–≤–∏–¥—è—Ç —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É.</p>
                
                <div class="property-management">
                    <div class="property-list">
                        <h3 style="color: var(--accent-blue); margin-bottom: 15px;">–°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤</h3>
                        <div id="adminPropertiesList">
                            <!-- –°–ø–∏—Å–æ–∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                        </div>
                    </div>
                    
                    <div class="property-form">
                        <h3 style="color: var(--accent-blue); margin-bottom: 20px;" id="propertyFormTitle">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç</h3>
                        
                        <div class="image-upload" onclick="document.getElementById('propertyImageUpload').click()">
                            <input type="file" id="propertyImageUpload" accept="image/*" onchange="previewPropertyImage(event)">
                            <div style="color: var(--light-blue); margin-bottom: 10px;">
                                <div style="font-size: 3rem;">üì∑</div>
                                <div>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</div>
                                <div style="font-size: 0.8rem; margin-top: 5px;">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 800x600px</div>
                            </div>
                            <div class="image-preview" id="propertyImagePreview">
                                <!-- –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                            </div>
                        </div>
                        
                        <div id="propertyFormFields" class="hidden">
                            <div class="form-grid">
                                <div>
                                    <label style="color: var(--light-blue); display: block; margin-bottom: 8px;">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                                    <input type="text" id="editPropertyTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏">
                                </div>
                                <div>
                                    <label style="color: var(--light-blue); display: block; margin-bottom: 8px;">–¢–∏–ø</label>
                                    <select id="editPropertyType">
                                        <option value="apartment">–ö–≤–∞—Ä—Ç–∏—Ä–∞</option>
                                        <option value="house">–î–æ–º</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div>
                                    <label style="color: var(--light-blue); display: block; margin-bottom: 8px;">–†–∞–π–æ–Ω</label>
                                    <select id="editPropertyDistrict">
                                        <option value="poor">–ë–µ–¥–Ω—ã–π —Ä–∞–π–æ–Ω</option>
                                        <option value="good">–•–æ—Ä–æ—à–∏–π —Ä–∞–π–æ–Ω</option>
                                        <option value="elite">–≠–ª–∏—Ç–Ω—ã–π —Ä–∞–π–æ–Ω</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="color: var(--light-blue); display: block; margin-bottom: 8px;">–¶–µ–Ω–∞ ($)</label>
                                    <input type="number" id="editPropertyPrice" placeholder="–¶–µ–Ω–∞">
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div>
                                    <label style="color: var(--light-blue); display: block; margin-bottom: 8px;">–ö–æ–º–Ω–∞—Ç—ã</label>
                                    <input type="text" id="editPropertyRooms" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 2 —Å–ø–∞–ª—å–Ω–∏">
                                </div>
                                <div>
                                    <label style="color: var(--light-blue); display: block; margin-bottom: 8px;">–ü–ª–æ—â–∞–¥—å</label>
                                    <input type="text" id="editPropertySize" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 85 –º¬≤">
                                </div>
                            </div>
                            
                            <div>
                                <label style="color: var(--light-blue); display: block; margin-bottom: 8px;">–î–æ—Ö–æ–¥ –æ—Ç –∞—Ä–µ–Ω–¥—ã ($/–Ω–µ–¥–µ–ª—è)</label>
                                <input type="number" id="editPropertyRental" placeholder="–î–æ—Ö–æ–¥ –æ—Ç –∞—Ä–µ–Ω–¥—ã">
                            </div>
                            
                            <div>
                                <label style="color: var(--light-blue); display: block; margin-bottom: 8px;">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                <textarea id="editPropertyDescription" rows="4" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏..."></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button class="btn btn-success" onclick="savePropertyChanges()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                                <button class="btn btn-danger" onclick="resetPropertyImage()">–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</button>
                            </div>
                        </div>
                        
                        <div id="propertyFormEmpty" style="text-align: center; padding: 40px; color: var(--light-blue);">
                            <p>–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div id="adminTabStats" class="admin-section hidden">
                <h2 style="color: var(--accent-blue); margin-bottom: 20px;">–°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div>
                        <div style="color: var(--light-blue);">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        <div style="font-size: 1.5rem; color: var(--accent-blue); font-weight: bold;" id="totalUsers">0</div>
                    </div>
                    <div>
                        <div style="color: var(--light-blue);">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤</div>
                        <div style="font-size: 1.5rem; color: var(--success); font-weight: bold;" id="totalBalance">$0</div>
                    </div>
                    <div>
                        <div style="color: var(--light-blue);">–í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
                        <div style="font-size: 1.5rem; color: var(--warning); font-weight: bold;" id="totalTransactions">0</div>
                    </div>
                    <div>
                        <div style="color: var(--light-blue);">–û–±—ä–µ–∫—Ç–æ–≤ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏</div>
                        <div style="font-size: 1.5rem; color: var(--accent-blue); font-weight: bold;" id="propertiesWithPhotos">0</div>
                    </div>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞: –î–µ–π—Å—Ç–≤–∏—è -->
            <div id="adminTabActions" class="admin-section hidden">
                <h2 style="color: var(--accent-blue); margin-bottom: 20px;">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-warning" onclick="exportAllData()">–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
                    <button class="btn btn-primary" onclick="importAllData()">–ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
                    <button class="btn btn-danger" onclick="resetDemoData()">–°–±—Ä–æ—Å–∏—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ</button>
                    <button class="btn btn-primary" onclick="addDemoUsers()">–î–æ–±–∞–≤–∏—Ç—å –¥–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
                    <button class="btn btn-success" onclick="addDefaultPhotos()">–î–æ–±–∞–≤–∏—Ç—å –¥–µ–º–æ-—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</button>
                </div>
                
                <!-- –ü–æ–ª–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ -->
                <input type="file" id="importAllFile" accept=".json" style="display: none;" onchange="handleImportAllFile(event)">
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è -->
            <div id="adminTabSync" class="admin-section hidden">
                <h2 style="color: var(--accent-blue); margin-bottom: 20px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π</h2>
                
                <div class="card" style="margin-bottom: 20px;">
                    <h3 style="color: var(--accent-blue); margin-bottom: 15px;">–°—Ç–∞—Ç—É—Å Firebase</h3>
                    <div id="firebaseStatus" style="color: var(--light-blue); margin-bottom: 10px;">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</div>
                    <div style="color: var(--light-blue); font-size: 0.9rem;">
                        <p>Firebase ID: <span id="firebaseProjectId" style="color: white;">–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ</span></p>
                        <p>–í—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: <span id="firebaseDocCount" style="color: white;">0</span></p>
                        <p>–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: <span id="lastSyncTime" style="color: white;">–ù–∏–∫–æ–≥–¥–∞</span></p>
                    </div>
                </div>
                
                <div class="card">
                    <h3 style="color: var(--accent-blue); margin-bottom: 15px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--light-blue); display: block; margin-bottom: 8px;">–†–µ–∂–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</label>
                        <select id="globalSyncMode" onchange="changeSyncMode(this.value)">
                            <option value="online">–û–Ω–ª–∞–π–Ω (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ–±–ª–∞–∫–µ)</option>
                            <option value="offline">–¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="forceSyncToFirebase()">üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
                        <button class="btn btn-warning" onclick="downloadBackup()">üì• –°–∫–∞—á–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</button>
                        <button class="btn btn-danger" onclick="clearFirebaseData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ–±–ª–∞—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫—É–ø–∫–∏ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏) -->
    <div class="modal" id="purchaseModal">
        <div class="modal-content modal-wide">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏</h2>
            
            <!-- –ì–∞–ª–µ—Ä–µ—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π -->
            <div class="property-gallery" id="propertyGallery">
                <img class="gallery-image" id="galleryMainImage" src="" alt="–§–æ—Ç–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏" style="display: none;">
                <div class="gallery-nav">
                    <button class="gallery-btn" onclick="changeGalleryImage(-1)">‚Äπ</button>
                    <button class="gallery-btn" onclick="changeGalleryImage(1)">‚Ä∫</button>
                </div>
                <div class="gallery-dots" id="galleryDots">
                    <!-- –¢–æ—á–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <div id="modalPropertyInfo"></div>
            <div class="purchase-details">
                <div class="detail-row">
                    <span>–°—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                    <span id="modalPrice" style="color:var(--success); font-weight:bold;">$0</span>
                </div>
                <div class="detail-row">
                    <span>–í–∞—à –±–∞–ª–∞–Ω—Å:</span>
                    <span id="modalBalance" style="color:var(--success); font-weight:bold;">$0</span>
                </div>
                <div class="detail-row">
                    <span>–û—Å—Ç–∞—Ç–æ–∫ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏:</span>
                    <span id="modalRemaining" style="color:var(--danger); font-weight:bold;">$0</span>
                </div>
            </div>
            <button class="btn btn-success confirm-btn" onclick="confirmPurchase()" style="width: 100%; padding: 15px;">–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –ü–û–ö–£–ü–ö–£</button>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
    <div class="sync-status hidden" id="syncStatus">
        <div class="sync-indicator" id="syncIndicator"></div>
        <span id="syncText">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</span>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notificationContainer"></div>

    <!-- –§—É—Ç–µ—Ä -->
    <footer>
        <p>BlueLine Estates ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
        <p>¬© 2024 –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –ø–æ–ª–∏—Ü–∏–∏ –≥–æ—Ä–æ–¥–∞. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        <p style="margin-top:10px; font-size:0.8rem; color:#666;">–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –æ–±–ª–∞–∫–µ</p>
    </footer>

    <script>
        // ==================== FIREBASE –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        // ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏—á–Ω—ã–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ
        const firebaseConfig = {
            apiKey: "AIzaSyB_BQ-cTJVt0nCv3IFeZQjAKcAhlGG-aWY",
            authDomain: "real-estate-system-8d5e8.firebaseapp.com",
            projectId: "real-estate-system-8d5e8",
            storageBucket: "real-estate-system-8d5e8.appspot.com",
            messagingSenderId: "1092288709476",
            appId: "1:1092288709476:web:cdd5d63c82b63c98db2b0d",
            measurementId: "G-9TJF7TNZ4M"
        };

        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ê–î–ú–ò–ù–ê ====================
        const ADMIN_CONFIG = {
            SECRET_CODE: "BLUEADMIN2024",
            SECRET_USERNAME: "admin",
            SECRET_PASSWORD: "admin123"
        };

        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let firebaseApp = null;
        let firestore = null;
        let auth = null;
        let unsubscribeUsers = null;
        let unsubscribeProperties = null;
        let syncMode = localStorage.getItem('real_estate_sync_mode') || 'online';
        let isOnline = navigator.onLine;
        
        // –î–∞–Ω–Ω—ã–µ
        let properties = [];
        let users = [];
        let currentUser = null;
        let transactions = [];
        
        // –ö–ª—é—á–∏ –¥–ª—è LocalStorage (—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
        const STORAGE_KEYS = {
            USERS: 'real_estate_users_cloud',
            CURRENT_USER: 'real_estate_current_user_cloud',
            TRANSACTIONS: 'real_estate_transactions_cloud',
            PROPERTIES: 'real_estate_properties_cloud',
            LAST_SYNC: 'real_estate_last_sync'
        };

        // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
        const demoPropertiesData = [
            {
                id: 1,
                type: "apartment",
                district: "poor",
                title: "–ö–æ–º–Ω–∞—Ç–∞ –≤ —Ä–∞–π–æ–Ω–µ –ß–µ–º–±–µ—Ä–ª–µ–Ω-–•–∏–ª–ª–∑",
                description: "–ö–æ–º–Ω–∞—Ç–∞ –≤ –æ–±—â–µ–∂–∏—Ç–∏–∏ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —É–¥–æ–±—Å—Ç–≤–∞, –Ω–æ —Å–≤–æ—è –∫—Ä—ã—à–∞ –Ω–∞–¥ –≥–æ–ª–æ–≤–æ–π. 4 —Å–æ—Å–µ–¥–∞, –æ–±—â–∏–π —Å–∞–Ω—É–∑–µ–ª.",
                price: 25000,
                rooms: "1 –∫–æ–º–Ω–∞—Ç–∞",
                size: "18 –º¬≤",
                imageColor: "#8B4513",
                rentalIncome: 100,
                photos: [],
                hasCustomImage: false
            },
            {
                id: 2,
                type: "apartment",
                district: "poor",
                title: "–°—Ç—É–¥–∏—è –≤ –ø—Ä–æ–º–∑–æ–Ω–µ",
                description: "–ú–∞–ª–µ–Ω—å–∫–∞—è —Å—Ç—É–¥–∏—è —Å –≤–∏–¥–æ–º –Ω–∞ –∑–∞–≤–æ–¥—Å–∫–∏–µ —Ç—Ä—É–±—ã. –°–≤–æ—è –º–∏–Ω–∏-–∫—É—Ö–Ω—è –∏ —Å–∞–Ω—É–∑–µ–ª. –¢—Ä–µ–±—É–µ—Ç –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞.",
                price: 55000,
                rooms: "–°—Ç—É–¥–∏—è",
                size: "30 –º¬≤",
                imageColor: "#A0522D",
                rentalIncome: 200,
                photos: [],
                hasCustomImage: false
            },
            {
                id: 3,
                type: "apartment",
                district: "good",
                title: "1-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –≤ –í–µ—Å–ø—É—á—á–∏",
                description: "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ —Å–ø–∞–ª—å–Ω–æ–º —Ä–∞–π–æ–Ω–µ. –†–µ–º–æ–Ω—Ç, –ø–∞—Ä–∫–æ–≤–∫–∞, —Ä—è–¥–æ–º –ø–∞—Ä–∫. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞.",
                price: 220000,
                rooms: "1 –∫–æ–º–Ω–∞—Ç–∞",
                size: "60 –º¬≤",
                imageColor: "#4682B4",
                rentalIncome: 450,
                photos: [],
                hasCustomImage: false
            },
            {
                id: 4,
                type: "apartment",
                district: "good",
                title: "2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –≤ –ü–∏–ª–ª–±–æ–∫—Å –•–∏–ª–ª",
                description: "–ü—Ä–æ—Å—Ç–æ—Ä–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –¥–ª—è —Å–µ–º—å–∏. –î–µ—Ç—Å–∫–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –≤–æ –¥–≤–æ—Ä–µ, –∫–æ–Ω—Å—å–µ—Ä–∂, –ø–æ–¥–∑–µ–º–Ω—ã–π –ø–∞—Ä–∫–∏–Ω–≥.",
                price: 380000,
                rooms: "2 –∫–æ–º–Ω–∞—Ç—ã",
                size: "85 –º¬≤",
                imageColor: "#5F9EA0",
                rentalIncome: 700,
                photos: [],
                hasCustomImage: false
            },
            {
                id: 5,
                type: "house",
                district: "poor",
                title: "–î–æ–º–∏–∫ –≤ –î—ç–≤–∏—Å–µ",
                description: "–ù–µ–±–æ–ª—å—à–æ–π –¥–æ–º —Å —É—á–∞—Å—Ç–∫–æ–º. –¢—Ä–µ–±—É–µ—Ç –≤–ª–æ–∂–µ–Ω–∏–π –≤ —Ä–µ–º–æ–Ω—Ç, –Ω–æ –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª. –°–≤–æ–π –≥–∞—Ä–∞–∂.",
                price: 180000,
                rooms: "2 —Å–ø–∞–ª—å–Ω–∏",
                size: "80 –º¬≤",
                imageColor: "#CD853F",
                rentalIncome: 400,
                photos: [],
                hasCustomImage: false
            },
            {
                id: 6,
                type: "house",
                district: "good",
                title: "–î–æ–º –≤ –ú–∏—Ä—Ä–æ—Ä –ü–∞—Ä–∫",
                description: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–µ–º–µ–π–Ω—ã–π –¥–æ–º –≤ —Ç–∏—Ö–æ–º —Ä–∞–π–æ–Ω–µ. –ì–∞—Ä–∞–∂ –Ω–∞ 2 –∞–≤—Ç–æ, –∑–∞–¥–Ω–∏–π –¥–≤–æ—Ä, –∑–µ–ª—ë–Ω—ã–π –≥–∞–∑–æ–Ω.",
                price: 650000,
                rooms: "3 —Å–ø–∞–ª—å–Ω–∏",
                size: "120 –º¬≤",
                imageColor: "#20B2AA",
                rentalIncome: 1200,
                photos: [],
                hasCustomImage: false
            },
            {
                id: 7,
                type: "apartment",
                district: "elite",
                title: "–õ–æ—Ñ—Ç –≤ –†–æ–∫—Ñ–æ—Ä–¥ –•–∏–ª–ª–∑",
                description: "–≠–ª–∏—Ç–Ω—ã–µ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã —Å –ø–∞–Ω–æ—Ä–∞–º–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏. –í—ã—Å–æ–∫–∏–µ –ø–æ—Ç–æ–ª–∫–∏, –¥–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç, —É–º–Ω—ã–π –¥–æ–º.",
                price: 1200000,
                rooms: "–õ–æ—Ñ—Ç",
                size: "120 –º¬≤",
                imageColor: "#9370DB",
                rentalIncome: 2500,
                photos: [],
                hasCustomImage: false
            },
            {
                id: 8,
                type: "house",
                district: "elite",
                title: "–û—Å–æ–±–Ω—è–∫ –≤ –í–∞–π–Ω–≤—É–¥ –•–∏–ª–ª–∑",
                description: "–†–æ—Å–∫–æ—à–Ω—ã–π –æ—Å–æ–±–Ω—è–∫ –Ω–∞ –∑–∞–∫—Ä—ã—Ç–æ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏. –ë–∞—Å—Å–µ–π–Ω, –¥–æ–º–∞—à–Ω–∏–π –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä, –≥–∞—Ä–∞–∂ –Ω–∞ 4 –∞–≤—Ç–æ.",
                price: 4200000,
                rooms: "5 —Å–ø–∞–ª–µ–Ω",
                size: "400 –º¬≤",
                imageColor: "#DA70D6",
                rentalIncome: 5000,
                photos: [],
                hasCustomImage: false
            }
        ];

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FIREBASE ====================
        
        async function initializeFirebase() {
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                updateSyncStatus('syncing', '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase...');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
                firebaseApp = firebase.initializeApp(firebaseConfig);
                firestore = firebase.firestore();
                auth = firebase.auth();
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–∞–±–æ—Ç—É –æ—Ñ—Ñ–ª–∞–π–Ω
                firestore.enablePersistence()
                    .catch((err) => {
                        console.log('–û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:', err);
                    });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                const connectedRef = firestore.collection("connected").doc("status");
                
                firestore.collection("connected").doc("status").set({
                    lastUpdated: new Date().toISOString(),
                    app: "Real Estate System"
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                updateSyncStatus('synced', '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase');
                showNotification('Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω', 'success');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Firebase
                await loadDataFromFirebase();
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ Firebase:', error);
                updateSyncStatus('error', '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
                showNotification('Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω. –†–∞–±–æ—Ç–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ.', 'warning');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                loadLocalData();
                return false;
            }
        }

        // ==================== –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–• ====================
        
        async function loadDataFromFirebase() {
            try {
                updateSyncStatus('syncing', '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const usersSnapshot = await firestore.collection('users').get();
                const firebaseUsers = [];
                usersSnapshot.forEach(doc => {
                    firebaseUsers.push({ id: doc.id, ...doc.data() });
                });
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
                const propertiesSnapshot = await firestore.collection('properties').get();
                const firebaseProperties = [];
                propertiesSnapshot.forEach(doc => {
                    firebaseProperties.push({ id: doc.id, ...doc.data() });
                });
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                const transactionsSnapshot = await firestore.collection('transactions').get();
                const firebaseTransactions = [];
                transactionsSnapshot.forEach(doc => {
                    firebaseTransactions.push({ id: doc.id, ...doc.data() });
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                if (firebaseUsers.length > 0) users = firebaseUsers;
                if (firebaseProperties.length > 0) properties = firebaseProperties;
                if (firebaseTransactions.length > 0) transactions = firebaseTransactions;
                
                // –ï—Å–ª–∏ –≤ Firebase –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                if (properties.length === 0) {
                    properties = JSON.parse(JSON.stringify(demoPropertiesData));
                    await savePropertiesToFirebase();
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                saveLocalData();
                
                updateSyncStatus('synced', `–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                if (currentUser) {
                    updateUserInfo();
                    if (!document.getElementById('mainPage').classList.contains('hidden')) {
                        renderProperties();
                    }
                }
                
                // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                setupRealtimeListeners();
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                updateSyncStatus('error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                loadLocalData();
                return false;
            }
        }

        function setupRealtimeListeners() {
            // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–ª—É—à–∞—Ç–µ–ª–µ–π
            if (unsubscribeUsers) unsubscribeUsers();
            if (unsubscribeProperties) unsubscribeProperties();
            
            // –°–ª—É—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            unsubscribeUsers = firestore.collection('users').onSnapshot((snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'modified' || change.type === 'added') {
                        const userData = { id: change.doc.id, ...change.doc.data() };
                        const index = users.findIndex(u => u.id === userData.id);
                        
                        if (index !== -1) {
                            users[index] = userData;
                        } else {
                            users.push(userData);
                        }
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –æ–±–Ω–æ–≤–ª—è–µ–º
                        if (currentUser && currentUser.id === userData.id) {
                            currentUser = userData;
                            localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
                            updateUserInfo();
                        }
                    }
                });
            });
            
            // –°–ª—É—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
            unsubscribeProperties = firestore.collection('properties').onSnapshot((snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'modified' || change.type === 'added') {
                        const propertyData = { id: change.doc.id, ...change.doc.data() };
                        const index = properties.findIndex(p => p.id === propertyData.id);
                        
                        if (index !== -1) {
                            properties[index] = propertyData;
                        } else {
                            properties.push(propertyData);
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        if (!document.getElementById('mainPage').classList.contains('hidden')) {
                            renderProperties();
                        }
                    }
                });
            });
        }

        async function saveUserToFirebase(user) {
            if (syncMode !== 'online' || !firestore) return;
            
            try {
                updateSyncStatus('syncing', '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
                await firestore.collection('users').doc(user.id.toString()).set(user, { merge: true });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                localStorage.setItem(STORAGE_KEYS.LAST_SYNC, new Date().toISOString());
                updateSyncStatus('synced', '–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                updateSyncStatus('error', '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                return false;
            }
        }

        async function savePropertiesToFirebase() {
            if (syncMode !== 'online' || !firestore) return;
            
            try {
                updateSyncStatus('syncing', '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏...');
                
                for (const property of properties) {
                    await firestore.collection('properties').doc(property.id.toString()).set(property, { merge: true });
                }
                
                localStorage.setItem(STORAGE_KEYS.LAST_SYNC, new Date().toISOString());
                updateSyncStatus('synced', '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏:', error);
                updateSyncStatus('error', '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                return false;
            }
        }

        async function saveTransactionToFirebase(transaction) {
            if (syncMode !== 'online' || !firestore) return;
            
            try {
                await firestore.collection('transactions').doc(transaction.id.toString()).set(transaction, { merge: true });
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:', error);
                return false;
            }
        }

        // ==================== –õ–û–ö–ê–õ–¨–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï ====================
        
        function loadLocalData() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ LocalStorage
            const localUsers = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS)) || [];
            const localProperties = JSON.parse(localStorage.getItem(STORAGE_KEYS.PROPERTIES));
            const localCurrentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER));
            const localTransactions = JSON.parse(localStorage.getItem(STORAGE_KEYS.TRANSACTIONS)) || [];
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
            if (localUsers.length > 0) users = localUsers;
            if (localProperties) properties = localProperties;
            if (localCurrentUser) currentUser = localCurrentUser;
            if (localTransactions.length > 0) transactions = localTransactions;
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–º–æ
            if (!properties || properties.length === 0) {
                properties = JSON.parse(JSON.stringify(demoPropertiesData));
                saveLocalData();
            }
        }

        function saveLocalData() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ LocalStorage –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤
            localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
            localStorage.setItem(STORAGE_KEYS.PROPERTIES, JSON.stringify(properties));
            localStorage.setItem(STORAGE_KEYS.TRANSACTIONS, JSON.stringify(transactions));
            if (currentUser) {
                localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
            }
        }

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ï–ô ====================
        
        function updateSyncStatus(status, text = '') {
            const indicator = document.getElementById('syncIndicator');
            const statusText = document.getElementById('syncText');
            const statusElement = document.getElementById('syncStatus');
            
            if (syncMode === 'offline') {
                statusElement.classList.add('hidden');
                return;
            }
            
            statusElement.classList.remove('hidden');
            indicator.className = 'sync-indicator';
            
            switch(status) {
                case 'syncing':
                    indicator.classList.add('syncing');
                    statusText.textContent = text || '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...';
                    break;
                case 'synced':
                    indicator.classList.add('synced');
                    statusText.textContent = text || '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ';
                    setTimeout(() => {
                        if (indicator.classList.contains('synced')) {
                            statusElement.classList.add('hidden');
                        }
                    }, 2000);
                    break;
                case 'error':
                    indicator.classList.add('error');
                    statusText.textContent = text || '–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏';
                    break;
                case 'offline':
                    indicator.classList.add('error');
                    statusText.textContent = '–û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º';
                    break;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
            if (status === 'synced') {
                document.getElementById('lastSyncTime').textContent = new Date().toLocaleString();
            }
        }

        function changeSyncMode(mode) {
            syncMode = mode;
            localStorage.setItem('real_estate_sync_mode', mode);
            
            if (mode === 'online') {
                initializeFirebase();
                showNotification('–í–∫–ª—é—á–µ–Ω –æ–Ω–ª–∞–π–Ω —Ä–µ–∂–∏–º', 'success');
            } else {
                showNotification('–í–∫–ª—é—á–µ–Ω –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º', 'warning');
                updateSyncStatus('offline');
            }
        }

        async function forceSyncToFirebase() {
            if (!firestore) {
                showNotification('Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω', 'error');
                return;
            }
            
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                for (const user of users) {
                    await saveUserToFirebase(user);
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å—é –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
                await savePropertiesToFirebase();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                for (const transaction of transactions) {
                    await saveTransactionToFirebase(transaction);
                }
                
                showNotification('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –æ–±–ª–∞–∫–æ–º', 'success');
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ' + error.message, 'error');
            }
        }

        async function clearFirebaseData() {
            if (!confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–±–ª–∞–∫–∞. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) return;
            
            try {
                updateSyncStatus('syncing', '–û—á–∏—Å—Ç–∫–∞ –æ–±–ª–∞—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
                
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ –≤—Å–µ—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π
                const collections = ['users', 'properties', 'transactions'];
                
                for (const collectionName of collections) {
                    const snapshot = await firestore.collection(collectionName).get();
                    const batch = firestore.batch();
                    
                    snapshot.docs.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    
                    await batch.commit();
                }
                
                showNotification('–û–±–ª–∞—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'success');
                updateSyncStatus('synced', '–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: ' + error.message, 'error');
                updateSyncStatus('error', '–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏');
            }
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ ====================
        
        async function initializeSystem() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            document.getElementById('syncMode').value = syncMode;
            document.getElementById('globalSyncMode').value = syncMode;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
            loadLocalData();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            currentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER)) || null;
            
            // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –æ–Ω–ª–∞–π–Ω —Ä–µ–∂–∏–º, –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Firebase
            if (syncMode === 'online') {
                const firebaseConnected = await initializeFirebase();
                
                if (!firebaseConnected) {
                    showNotification('–†–∞–±–æ—Ç–∞–µ–º –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ', 'warning');
                }
            } else {
                updateSyncStatus('offline');
                showNotification('–û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º', 'warning');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            if (currentUser) {
                showApp();
            } else {
                showAuth();
            }
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ====================
        
        function switchAuthTab(tab) {
            document.getElementById('loginForm').classList.toggle('hidden', tab !== 'login');
            document.getElementById('registerForm').classList.toggle('hidden', tab !== 'register');
            
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            const secretField = document.getElementById('adminSecretCode');
            secretField.style.display = tab === 'login' ? 'block' : 'none';
        }

        async function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const secretCode = document.getElementById('adminSecretCode').value.trim();
            const syncModeSelect = document.getElementById('syncMode').value;
            
            if (!username || !password) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å', 'error');
                return;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            syncMode = syncModeSelect;
            localStorage.setItem('real_estate_sync_mode', syncMode);
            document.getElementById('globalSyncMode').value = syncMode;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∞–¥–º–∏–Ω—Å–∫–∏–π –≤—Ö–æ–¥
            if (username === ADMIN_CONFIG.SECRET_USERNAME && 
                password === ADMIN_CONFIG.SECRET_PASSWORD &&
                secretCode === ADMIN_CONFIG.SECRET_CODE) {
                
                let adminUser = users.find(u => u.username === ADMIN_CONFIG.SECRET_USERNAME);
                
                if (!adminUser) {
                    adminUser = {
                        id: 999999,
                        firstName: '–°–∏—Å—Ç–µ–º–Ω—ã–π',
                        lastName: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                        username: ADMIN_CONFIG.SECRET_USERNAME,
                        password: ADMIN_CONFIG.SECRET_PASSWORD,
                        balance: 10000000,
                        properties: [],
                        isAdmin: true,
                        isHiddenAdmin: true,
                        registrationDate: new Date().toISOString()
                    };
                    users.push(adminUser);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ –∏ –ª–æ–∫–∞–ª—å–Ω–æ
                    if (syncMode === 'online' && firestore) {
                        await saveUserToFirebase(adminUser);
                    }
                    saveLocalData();
                }
                
                currentUser = adminUser;
                localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
                
                if (syncMode === 'online' && firestore) {
                    await saveUserToFirebase(currentUser);
                }
                
                showApp();
                showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –°–ò–°–¢–ï–ú–ù–´–ô –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†!`, 'success');
                return;
            }
            
            // –û–±—ã—á–Ω—ã–π –≤—Ö–æ–¥
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –æ–±–ª–∞–∫–µ
                if (syncMode === 'online' && firestore) {
                    await saveUserToFirebase(currentUser);
                }
                
                showApp();
                showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.firstName} ${user.lastName}!`, 'success');
            } else {
                showNotification('–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
            }
        }

        async function register() {
            const firstName = document.getElementById('regFirstName').value.trim();
            const lastName = document.getElementById('regLastName').value.trim();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value.trim();
            const confirmPassword = document.getElementById('regConfirmPassword').value.trim();
            
            if (!firstName || !lastName || !username || !password) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                return;
            }
            
            if (users.some(u => u.username === username)) {
                showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                return;
            }
            
            if (username === ADMIN_CONFIG.SECRET_USERNAME) {
                showNotification('–≠—Ç–æ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ —Å–∏—Å—Ç–µ–º–æ–π', 'error');
                return;
            }
            
            const newUser = {
                id: Date.now().toString(),
                firstName,
                lastName,
                username,
                password,
                balance: 100000,
                properties: [],
                isAdmin: false,
                registrationDate: new Date().toISOString()
            };
            
            users.push(newUser);
            
            currentUser = newUser;
            localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ
            if (syncMode === 'online' && firestore) {
                await saveUserToFirebase(currentUser);
            }
            saveLocalData();
            
            showApp();
            showNotification(`–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${firstName}!`, 'success');
        }

        function logout() {
            // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç —Å–ª—É—à–∞—Ç–µ–ª–µ–π Firebase
            if (unsubscribeUsers) unsubscribeUsers();
            if (unsubscribeProperties) unsubscribeProperties();
            
            currentUser = null;
            localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
            showAuth();
            showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'warning');
        }

        // ==================== –°–ö–†–´–¢–ê–Ø –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ ====================
        
        function showAdminPanel() {
            if (!currentUser || !currentUser.isAdmin) {
                showNotification('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω', 'error');
                return;
            }
            
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('myPropertiesPage').classList.add('hidden');
            document.getElementById('adminPage').classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Firebase
            if (firestore) {
                document.getElementById('firebaseStatus').innerHTML = 
                    '<span style="color: #2ecc71;">‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>';
                document.getElementById('firebaseProjectId').textContent = firebaseConfig.projectId;
                document.getElementById('lastSyncTime').textContent = 
                    localStorage.getItem(STORAGE_KEYS.LAST_SYNC) || '–ù–∏–∫–æ–≥–¥–∞';
            } else {
                document.getElementById('firebaseStatus').innerHTML = 
                    '<span style="color: #e74c3c;">‚úó –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</span>';
            }
            
            document.getElementById('firebaseDocCount').textContent = users.length + properties.length + transactions.length;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É
            switchAdminTab('users');
        }

        // ==================== –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° ====================
        
        function showAuth() {
            document.getElementById('authPage').classList.remove('hidden');
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('myPropertiesPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('navbar').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('navbar').classList.remove('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('navLinks').classList.remove('hidden');
            
            updateUserInfo();
            
            const adminButton = document.getElementById('adminNavButton');
            if (currentUser && currentUser.isAdmin) {
                adminButton.classList.remove('hidden');
            } else {
                adminButton.classList.add('hidden');
            }
            
            showPage('main');
        }

        function showPage(page) {
            if (page === 'admin' && (!currentUser || !currentUser.isAdmin)) {
                showNotification('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω', 'error');
                return;
            }
            
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('myPropertiesPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            
            document.getElementById(page + 'Page').classList.remove('hidden');
            
            switch(page) {
                case 'main':
                    renderProperties();
                    break;
                case 'myProperties':
                    renderOwnedProperties();
                    break;
                case 'admin':
                    showAdminPanel();
                    break;
            }
        }

        function updateUserInfo() {
            if (!currentUser) return;
            
            if (currentUser.isHiddenAdmin) {
                document.getElementById('userBadge').textContent = '–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†';
                document.getElementById('userBadge').style.background = '#9b59b6';
            } else {
                document.getElementById('userBadge').textContent = 
                    currentUser.isAdmin ? '–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†' : 
                    `${currentUser.firstName} ${currentUser.lastName}`;
            }
            
            document.getElementById('userCash').textContent = `$${currentUser.balance.toLocaleString()}`;
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–ò ====================
        
        let selectedProperty = null;
        let currentGalleryIndex = 0;

        function renderProperties(filteredProps = properties) {
            const container = document.getElementById('propertiesContainer');
            container.innerHTML = '';

            const availableProps = filteredProps.filter(prop => 
                !currentUser.properties.includes(prop.id)
            );

            if (availableProps.length === 0) {
                container.innerHTML = `
                    <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 15px;">–í—Å—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –∫—É–ø–ª–µ–Ω–∞!</h3>
                        <p style="color: var(--light-blue);">–í—ã –ø—Ä–∏–æ–±—Ä–µ–ª–∏ –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –ø–æ —Ç–µ–∫—É—â–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º.</p>
                    </div>
                `;
                return;
            }

            availableProps.forEach(prop => {
                const districtNames = {
                    poor: "–ë–µ–¥–Ω—ã–π —Ä–∞–π–æ–Ω",
                    good: "–•–æ—Ä–æ—à–∏–π —Ä–∞–π–æ–Ω",
                    elite: "–≠–ª–∏—Ç–Ω—ã–π —Ä–∞–π–æ–Ω"
                };

                const districtClasses = {
                    poor: "district-poor",
                    good: "district-good",
                    elite: "district-elite"
                };

                const typeNames = {
                    apartment: "–ö–í–ê–†–¢–ò–†–ê",
                    house: "–î–û–ú"
                };

                const canAfford = currentUser.balance >= prop.price;
                const buttonText = canAfford ? "–ö–£–ü–ò–¢–¨" : "–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–†–ï–î–°–¢–í";

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ–Ω –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                let backgroundStyle = '';
                if (prop.photos && prop.photos.length > 0) {
                    backgroundStyle = `background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('${prop.photos[0]}'); background-size: cover; background-position: center;`;
                } else {
                    backgroundStyle = `background: linear-gradient(135deg, ${prop.imageColor}, #152642)`;
                }

                const card = document.createElement('div');
                card.className = 'property-card';
                card.innerHTML = `
                    <div class="property-image" style="${backgroundStyle}">
                        <div class="district-badge ${districtClasses[prop.district]}">${districtNames[prop.district]}</div>
                        ${prop.photos && prop.photos.length > 0 ? '<div style="position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.7rem;">üì∑ ' + prop.photos.length + ' —Ñ–æ—Ç–æ</div>' : ''}
                    </div>
                    <div class="property-info">
                        <div class="property-type">${typeNames[prop.type]}</div>
                        <h3 class="property-title">${prop.title}</h3>
                        <p class="property-description">${prop.description}</p>
                        <div class="property-details">
                            <div class="detail">
                                <div class="detail-value">${prop.rooms}</div>
                                <div class="detail-label">–ö–æ–º–Ω–∞—Ç—ã</div>
                            </div>
                            <div class="detail">
                                <div class="detail-value">${prop.size}</div>
                                <div class="detail-label">–ü–ª–æ—â–∞–¥—å</div>
                            </div>
                            <div class="detail">
                                <div class="detail-value">${prop.rentalIncome}/–Ω–µ–¥–µ–ª—è</div>
                                <div class="detail-label">–î–æ—Ö–æ–¥ –æ—Ç –∞—Ä–µ–Ω–¥—ã</div>
                            </div>
                        </div>
                        <div class="property-footer">
                            <div class="property-price">$${prop.price.toLocaleString()}</div>
                            <button class="buy-btn" ${!canAfford ? 'disabled' : ''} 
                                    onclick="openPurchaseModal(${prop.id})">
                                ${buttonText}
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function applyFilters() {
            const districtFilter = document.getElementById('districtFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            const maxPrice = parseInt(document.getElementById('priceSlider').value);

            const filtered = properties.filter(prop => {
                const districtMatch = districtFilter === 'all' || prop.district === districtFilter;
                const typeMatch = typeFilter === 'all' || prop.type === typeFilter;
                const priceMatch = prop.price <= maxPrice;
                return districtMatch && typeMatch && priceMatch;
            });

            renderProperties(filtered);
        }

        function openPurchaseModal(propertyId) {
            selectedProperty = properties.find(p => p.id == propertyId);
            if (!selectedProperty) return;

            const modal = document.getElementById('purchaseModal');
            const remaining = currentUser.balance - selectedProperty.price;

            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≥–∞–ª–µ—Ä–µ—é
            setupPropertyGallery(selectedProperty);

            document.getElementById('modalPropertyInfo').innerHTML = `
                <h3 style="margin-bottom:10px; color: white;">${selectedProperty.title}</h3>
                <p style="color:#b0b0b0; margin-bottom:15px; line-height: 1.6;">${selectedProperty.description}</p>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="color: var(--light-blue);">–†–∞–∑–º–µ—Ä:</span>
                    <span style="color: white;">${selectedProperty.size}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="color: var(--light-blue);">–ö–æ–º–Ω–∞—Ç—ã:</span>
                    <span style="color: white;">${selectedProperty.rooms}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: var(--light-blue);">–î–æ—Ö–æ–¥ –æ—Ç –∞—Ä–µ–Ω–¥—ã:</span>
                    <span style="color: var(--success);">$${selectedProperty.rentalIncome}/–Ω–µ–¥–µ–ª—è</span>
                </div>
            `;

            document.getElementById('modalPrice').textContent = `$${selectedProperty.price.toLocaleString()}`;
            document.getElementById('modalBalance').textContent = `$${currentUser.balance.toLocaleString()}`;
            document.getElementById('modalRemaining').textContent = `$${remaining.toLocaleString()}`;
            
            if (remaining < 0) {
                document.getElementById('modalRemaining').style.color = 'var(--danger)';
            } else {
                document.getElementById('modalRemaining').style.color = 'var(--success)';
            }

            modal.style.display = 'flex';
        }

        function setupPropertyGallery(property) {
            const gallery = document.getElementById('propertyGallery');
            const imageElement = document.getElementById('galleryMainImage');
            const dotsContainer = document.getElementById('galleryDots');
            
            dotsContainer.innerHTML = '';
            currentGalleryIndex = 0;
            
            if (property.photos && property.photos.length > 0) {
                imageElement.src = property.photos[0];
                imageElement.style.display = 'block';
                gallery.style.display = 'block';
                
                property.photos.forEach((_, index) => {
                    const dot = document.createElement('button');
                    dot.className = 'gallery-dot' + (index === 0 ? ' active' : '');
                    dot.onclick = () => changeGalleryImageTo(index);
                    dotsContainer.appendChild(dot);
                });
            } else {
                gallery.style.background = `linear-gradient(135deg, ${property.imageColor}, #152642)`;
                gallery.style.display = 'flex';
                gallery.style.alignItems = 'center';
                gallery.style.justifyContent = 'center';
                gallery.innerHTML = `
                    <div style="text-align: center; color: white; font-size: 1.2rem;">
                        <div style="font-size: 3rem;">üè†</div>
                        <div>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>
                    </div>
                `;
                imageElement.style.display = 'none';
            }
        }

        function changeGalleryImage(direction) {
            if (!selectedProperty || !selectedProperty.photos || selectedProperty.photos.length <= 1) return;
            
            currentGalleryIndex += direction;
            if (currentGalleryIndex < 0) currentGalleryIndex = selectedProperty.photos.length - 1;
            if (currentGalleryIndex >= selectedProperty.photos.length) currentGalleryIndex = 0;
            
            changeGalleryImageTo(currentGalleryIndex);
        }

        function changeGalleryImageTo(index) {
            if (!selectedProperty || !selectedProperty.photos || !selectedProperty.photos[index]) return;
            
            currentGalleryIndex = index;
            document.getElementById('galleryMainImage').src = selectedProperty.photos[index];
            
            document.querySelectorAll('.gallery-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
        }

        function closeModal() {
            document.getElementById('purchaseModal').style.display = 'none';
            selectedProperty = null;
        }

        async function confirmPurchase() {
            if (!selectedProperty) return;

            if (currentUser.balance >= selectedProperty.price) {
                currentUser.balance -= selectedProperty.price;
                currentUser.properties.push(selectedProperty.id);
                
                const transaction = {
                    id: Date.now().toString(),
                    userId: currentUser.id,
                    type: 'property_purchase',
                    amount: -selectedProperty.price,
                    description: `–ü–æ–∫—É–ø–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏: ${selectedProperty.title}`,
                    date: new Date().toISOString(),
                    propertyId: selectedProperty.id
                };
                transactions.push(transaction);
                
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ
                if (syncMode === 'online' && firestore) {
                    await saveUserToFirebase(currentUser);
                    await saveTransactionToFirebase(transaction);
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                saveLocalData();
                
                updateUserInfo();
                applyFilters();
                
                showNotification(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∫—É–ø–∏–ª–∏: "${selectedProperty.title}"`, 'success');
                
                closeModal();
                
                if (!document.getElementById('myPropertiesPage').classList.contains('hidden')) {
                    renderOwnedProperties();
                }
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏!', 'error');
            }
        }

        // ==================== –ú–û–Ø –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–¨ ====================
        
        function renderOwnedProperties() {
            const container = document.getElementById('ownedPropertiesContainer');
            
            const ownedProperties = properties.filter(prop => 
                currentUser.properties.includes(prop.id)
            );
            
            if (ownedProperties.length === 0) {
                container.innerHTML = `
                    <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--light-blue);">
                        <p style="font-size: 1.2rem;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</p>
                        <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å" —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É</p>
                        <button class="btn btn-primary" onclick="showPage('main')" style="margin-top: 20px;">–°–º–æ—Ç—Ä–µ—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</button>
                    </div>
                `;
                
                document.getElementById('totalAssets').textContent = '$0';
                document.getElementById('propertyCount').textContent = '0';
                document.getElementById('rentalIncome').textContent = '$0/–Ω–µ–¥–µ–ª—è';
                return;
            }
            
            let totalValue = 0;
            let totalRentalIncome = 0;
            
            container.innerHTML = '';
            
            ownedProperties.forEach(prop => {
                totalValue += prop.price;
                totalRentalIncome += prop.rentalIncome;
                
                let backgroundStyle = '';
                if (prop.photos && prop.photos.length > 0) {
                    backgroundStyle = `background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('${prop.photos[0]}'); background-size: cover; background-position: center;`;
                } else {
                    backgroundStyle = `background: linear-gradient(135deg, ${prop.imageColor}, #152642)`;
                }
                
                const card = document.createElement('div');
                card.className = 'property-card owned-card';
                card.innerHTML = `
                    <div class="property-image" style="${backgroundStyle}">
                        <div class="district-badge ${prop.district === 'poor' ? 'district-poor' : prop.district === 'good' ? 'district-good' : 'district-elite'}">
                            ${prop.district === 'poor' ? '–ë–µ–¥–Ω—ã–π —Ä–∞–π–æ–Ω' : prop.district === 'good' ? '–•–æ—Ä–æ—à–∏–π —Ä–∞–π–æ–Ω' : '–≠–ª–∏—Ç–Ω—ã–π —Ä–∞–π–æ–Ω'}
                        </div>
                        ${prop.photos && prop.photos.length > 0 ? '<div style="position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.7rem;">üì∑ ' + prop.photos.length + ' —Ñ–æ—Ç–æ</div>' : ''}
                    </div>
                    <div class="property-info">
                        <div class="property-type">${prop.type === 'apartment' ? '–ö–í–ê–†–¢–ò–†–ê' : '–î–û–ú'}</div>
                        <h3 class="property-title">${prop.title}</h3>
                        <p class="property-description">${prop.description}</p>
                        <div class="property-details">
                            <div class="detail">
                                <div class="detail-value">${prop.rooms}</div>
                                <div class="detail-label">–ö–æ–º–Ω–∞—Ç—ã</div>
                            </div>
                            <div class="detail">
                                <div class="detail-value">${prop.size}</div>
                                <div class="detail-label">–ü–ª–æ—â–∞–¥—å</div>
                            </div>
                            <div class="detail">
                                <div class="detail-value">$${prop.rentalIncome}</div>
                                <div class="detail-label">–î–æ—Ö–æ–¥/–Ω–µ–¥–µ–ª—è</div>
                            </div>
                        </div>
                        <div class="property-footer">
                            <div class="property-price">$${prop.price.toLocaleString()}</div>
                            <div style="color: var(--success); font-weight: bold;">–í —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
            
            document.getElementById('totalAssets').textContent = `$${totalValue.toLocaleString()}`;
            document.getElementById('propertyCount').textContent = ownedProperties.length;
            document.getElementById('rentalIncome').textContent = `$${totalRentalIncome.toLocaleString()}/–Ω–µ–¥–µ–ª—è`;
        }

        // ==================== –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ –î–ê–ù–ù–´–• ====================
        
        function exportUserData() {
            if (!currentUser) return;
            
            const userData = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                user: currentUser,
                properties: properties.filter(p => currentUser.properties.includes(p.id))
            };
            
            const dataStr = JSON.stringify(userData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `real_estate_${currentUser.username}_${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª', 'success');
        }

        function importUserData() {
            document.getElementById('importAllFile').click();
        }

        async function handleImportAllFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!importedData.user) {
                        throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                    }
                    
                    if (confirm('–í–Ω–∏–º–∞–Ω–∏–µ! –≠—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –≤–∞—à–∏ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                        // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–∞—Å—Å–∏–≤–µ users –∏ –∑–∞–º–µ–Ω—è–µ–º –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
                        const userIndex = users.findIndex(u => u.id === currentUser.id);
                        if (userIndex !== -1) {
                            users[userIndex] = importedData.user;
                            currentUser = importedData.user;
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ
                            if (syncMode === 'online' && firestore) {
                                await saveUserToFirebase(currentUser);
                            }
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                            saveLocalData();
                            
                            showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
                            
                            updateUserInfo();
                            if (!document.getElementById('myPropertiesPage').classList.contains('hidden')) {
                                renderOwnedProperties();
                            }
                            if (!document.getElementById('mainPage').classList.contains('hidden')) {
                                applyFilters();
                            }
                        }
                    }
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function downloadBackup() {
            const backupData = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                users: users,
                properties: properties,
                transactions: transactions
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `real_estate_backup_${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–∫–∞—á–∞–Ω–∞', 'success');
        }

        // ==================== –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ ====================
        
        function switchAdminTab(tabName) {
            document.getElementById('adminTabUsers').classList.add('hidden');
            document.getElementById('adminTabProperties').classList.add('hidden');
            document.getElementById('adminTabStats').classList.add('hidden');
            document.getElementById('adminTabActions').classList.add('hidden');
            document.getElementById('adminTabSync').classList.add('hidden');
            
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById('adminTab' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.remove('hidden');
            
            event.target.classList.add('active');
            
            switch(tabName) {
                case 'users':
                    renderUsersList();
                    break;
                case 'properties':
                    renderPropertiesManagement();
                    break;
                case 'stats':
                    updateAdminStats();
                    break;
                case 'sync':
                    break;
            }
        }

        function renderUsersList(filter = '') {
            const container = document.getElementById('usersList');
            container.innerHTML = '';
            
            let filteredUsers = users.filter(user => !user.isHiddenAdmin);
            
            if (filter) {
                const searchTerm = filter.toLowerCase();
                filteredUsers = filteredUsers.filter(user => 
                    user.firstName.toLowerCase().includes(searchTerm) ||
                    user.lastName.toLowerCase().includes(searchTerm) ||
                    user.username.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredUsers.length === 0) {
                container.innerHTML = '<div class="card" style="text-align: center; padding: 20px; color: var(--light-blue);">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            filteredUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                
                const ownedProperties = properties.filter(prop => 
                    user.properties.includes(prop.id)
                );
                const totalPropertyValue = ownedProperties.reduce((sum, prop) => sum + prop.price, 0);
                
                userItem.innerHTML = `
                    <div class="user-info-column">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                            <strong style="color: white; font-size: 1.1rem;">${user.firstName} ${user.lastName}</strong>
                            ${user.isAdmin ? '<span style="background: var(--warning); color: black; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">–ê–î–ú–ò–ù</span>' : ''}
                            ${user.id === currentUser.id ? '<span style="background: var(--accent-blue); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">–í–´</span>' : ''}
                        </div>
                        <div style="color: var(--light-blue); margin-bottom: 5px;">–õ–æ–≥–∏–Ω: ${user.username} | ID: ${user.id}</div>
                        <div style="display: flex; gap: 15px; color: var(--light-blue); font-size: 0.9rem;">
                            <div>–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏: <strong style="color: white;">${user.properties.length}</strong></div>
                            <div>–°—Ç–æ–∏–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤: <strong style="color: var(--success);">$${totalPropertyValue.toLocaleString()}</strong></div>
                        </div>
                    </div>
                    <div class="user-actions">
                        <div class="balance-control">
                            <input type="number" class="balance-input" id="balanceInput_${user.id}" 
                                   value="${user.balance}" placeholder="–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å">
                            <button class="btn btn-primary update-balance-btn" 
                                    onclick="updateUserBalance('${user.id}')">
                                –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                        <button class="btn btn-warning" onclick="addMoneyToUser('${user.id}', 10000)">+10–∫</button>
                        <button class="btn btn-danger" onclick="addMoneyToUser('${user.id}', -10000)">-10–∫</button>
                        ${!user.isAdmin && user.id !== currentUser.id ? 
                            `<button class="btn btn-danger" onclick="deleteUser('${user.id}')" style="padding: 8px 12px;">–£–¥–∞–ª–∏—Ç—å</button>` : ''}
                    </div>
                `;
                
                container.appendChild(userItem);
            });
        }

        async function updateUserBalance(userId) {
            const input = document.getElementById(`balanceInput_${userId}`);
            const newBalance = parseInt(input.value);
            
            if (isNaN(newBalance) || newBalance < 0) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', 'error');
                return;
            }
            
            const userIndex = users.findIndex(u => u.id === userId);
            if (userIndex === -1) return;
            
            const oldBalance = users[userIndex].balance;
            users[userIndex].balance = newBalance;
            
            const transaction = {
                id: Date.now().toString(),
                userId: userId,
                type: 'admin_adjustment',
                amount: newBalance - oldBalance,
                description: `–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º`,
                date: new Date().toISOString(),
                adminId: currentUser.id
            };
            transactions.push(transaction);
            
            if (currentUser.id === userId) {
                currentUser.balance = newBalance;
                saveLocalData();
                updateUserInfo();
                
                if (!document.getElementById('mainPage').classList.contains('hidden')) {
                    applyFilters();
                }
                if (!document.getElementById('myPropertiesPage').classList.contains('hidden')) {
                    renderOwnedProperties();
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ
            if (syncMode === 'online' && firestore) {
                await saveUserToFirebase(users[userIndex]);
                await saveTransactionToFirebase(transaction);
            }
            
            saveLocalData();
            
            showNotification(`–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${users[userIndex].firstName} –æ–±–Ω–æ–≤–ª—ë–Ω: $${newBalance.toLocaleString()}`, 'success');
            renderUsersList(document.getElementById('searchUser').value.trim());
            updateAdminStats();
        }

        function searchUsers() {
            const searchTerm = document.getElementById('searchUser').value.trim();
            renderUsersList(searchTerm);
        }

        function addMoneyToUser(userId, amount) {
            const userIndex = users.findIndex(u => u.id === userId);
            if (userIndex === -1) return;
            
            const newBalance = users[userIndex].balance + amount;
            
            if (newBalance < 0) {
                showNotification('–ë–∞–ª–∞–Ω—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º', 'error');
                return;
            }
            
            document.getElementById(`balanceInput_${userId}`).value = newBalance;
            updateUserBalance(userId);
        }

        async function deleteUser(userId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è? –í—Å–µ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
                return;
            }
            
            users = users.filter(u => u.id !== userId);
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ Firebase
            if (syncMode === 'online' && firestore) {
                try {
                    await firestore.collection('users').doc(userId).delete();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ Firebase:', error);
                }
            }
            
            saveLocalData();
            
            showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—ë–Ω', 'warning');
            renderUsersList(document.getElementById('searchUser').value.trim());
            updateAdminStats();
        }

        function updateAdminStats() {
            const visibleUsers = users.filter(user => !user.isHiddenAdmin);
            const totalBalance = visibleUsers.reduce((sum, user) => sum + user.balance, 0);
            const totalProperties = visibleUsers.reduce((sum, user) => sum + user.properties.length, 0);
            const totalPropertyValue = visibleUsers.reduce((sum, user) => {
                const userProperties = properties.filter(prop => user.properties.includes(prop.id));
                return sum + userProperties.reduce((propSum, prop) => propSum + prop.price, 0);
            }, 0);
            
            const propertiesWithPhotos = properties.filter(prop => prop.photos && prop.photos.length > 0).length;
            
            document.getElementById('totalUsers').textContent = visibleUsers.length;
            document.getElementById('totalBalance').textContent = `$${totalBalance.toLocaleString()}`;
            document.getElementById('totalTransactions').textContent = transactions.length;
            document.getElementById('propertiesWithPhotos').textContent = propertiesWithPhotos;
        }

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–¨–Æ ====================
        
        let currentlyEditingProperty = null;

        function renderPropertiesManagement() {
            const container = document.getElementById('adminPropertiesList');
            container.innerHTML = '';
            
            properties.forEach(prop => {
                const item = document.createElement('div');
                item.className = 'property-list-item';
                item.id = `adminProp_${prop.id}`;
                item.onclick = () => selectPropertyForEditing(prop.id);
                
                item.innerHTML = `
                    <div style="font-weight: bold; color: white; margin-bottom: 5px;">${prop.title}</div>
                    <div style="color: var(--light-blue); font-size: 0.9rem;">
                        ${prop.type === 'apartment' ? '–ö–≤–∞—Ä—Ç–∏—Ä–∞' : '–î–æ–º'} ‚Ä¢ ${prop.district === 'poor' ? '–ë–µ–¥–Ω—ã–π —Ä–∞–π–æ–Ω' : prop.district === 'good' ? '–•–æ—Ä–æ—à–∏–π —Ä–∞–π–æ–Ω' : '–≠–ª–∏—Ç–Ω—ã–π —Ä–∞–π–æ–Ω'}
                    </div>
                    <div style="color: var(--success); font-size: 0.9rem; margin-top: 5px;">
                        $${prop.price.toLocaleString()}
                        ${prop.photos && prop.photos.length > 0 ? ` ‚Ä¢ üì∑ ${prop.photos.length} —Ñ–æ—Ç–æ` : ''}
                    </div>
                `;
                
                container.appendChild(item);
            });
            
            document.getElementById('propertyFormFields').classList.add('hidden');
            document.getElementById('propertyFormEmpty').classList.remove('hidden');
            document.getElementById('propertyImagePreview').innerHTML = '';
            document.getElementById('propertyFormTitle').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç';
        }

        function selectPropertyForEditing(propertyId) {
            document.querySelectorAll('.property-list-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(`adminProp_${propertyId}`).classList.add('active');
            
            const property = properties.find(p => p.id == propertyId);
            if (!property) return;
            
            currentlyEditingProperty = property;
            
            document.getElementById('editPropertyTitle').value = property.title;
            document.getElementById('editPropertyType').value = property.type;
            document.getElementById('editPropertyDistrict').value = property.district;
            document.getElementById('editPropertyPrice').value = property.price;
            document.getElementById('editPropertyRooms').value = property.rooms;
            document.getElementById('editPropertySize').value = property.size;
            document.getElementById('editPropertyRental').value = property.rentalIncome;
            document.getElementById('editPropertyDescription').value = property.description;
            
            const previewContainer = document.getElementById('propertyImagePreview');
            previewContainer.innerHTML = '';
            
            if (property.photos && property.photos.length > 0) {
                property.photos.forEach((photo, index) => {
                    const imgWrapper = document.createElement('div');
                    imgWrapper.style.marginBottom = '10px';
                    imgWrapper.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                            <span style="color: var(--light-blue);">–§–æ—Ç–æ ${index + 1}</span>
                            <button class="btn btn-danger" style="padding: 3px 8px; font-size: 0.8rem;" onclick="removePropertyPhoto(${property.id}, ${index})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                        <img src="${photo}" style="max-width: 100%; max-height: 150px; border-radius: 4px;">
                    `;
                    previewContainer.appendChild(imgWrapper);
                });
                
                const photoCount = document.createElement('div');
                photoCount.style.color = 'var(--light-blue)';
                photoCount.style.marginTop = '10px';
                photoCount.textContent = `–í—Å–µ–≥–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π: ${property.photos.length}`;
                previewContainer.appendChild(photoCount);
            } else {
                previewContainer.innerHTML = '<div style="color: var(--light-blue); text-align: center; padding: 20px;">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –Ω–µ—Ç</div>';
            }
            
            document.getElementById('propertyFormFields').classList.remove('hidden');
            document.getElementById('propertyFormEmpty').classList.add('hidden');
            document.getElementById('propertyFormTitle').textContent = `–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ${property.title}`;
        }

        async function previewPropertyImage(event) {
            if (!currentlyEditingProperty) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏', 'error');
                return;
            }
            
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                if (!currentlyEditingProperty.photos) {
                    currentlyEditingProperty.photos = [];
                }
                
                currentlyEditingProperty.photos.push(e.target.result);
                currentlyEditingProperty.hasCustomImage = true;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ
                if (syncMode === 'online' && firestore) {
                    await savePropertiesToFirebase();
                }
                saveLocalData();
                
                selectPropertyForEditing(currentlyEditingProperty.id);
                
                showNotification('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                updateAdminStats();
                
                if (!document.getElementById('mainPage').classList.contains('hidden')) {
                    applyFilters();
                }
            };
            
            reader.readAsDataURL(file);
        }

        async function removePropertyPhoto(propertyId, photoIndex) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é?')) return;
            
            const property = properties.find(p => p.id == propertyId);
            if (!property || !property.photos || !property.photos[photoIndex]) return;
            
            property.photos.splice(photoIndex, 1);
            
            if (property.photos.length === 0) {
                property.hasCustomImage = false;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ
            if (syncMode === 'online' && firestore) {
                await savePropertiesToFirebase();
            }
            saveLocalData();
            
            selectPropertyForEditing(propertyId);
            
            showNotification('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É–¥–∞–ª–µ–Ω–∞', 'warning');
            updateAdminStats();
            
            if (!document.getElementById('mainPage').classList.contains('hidden')) {
                applyFilters();
            }
        }

        async function resetPropertyImage() {
            if (!currentlyEditingProperty) return;
            
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞?')) return;
            
            currentlyEditingProperty.photos = [];
            currentlyEditingProperty.hasCustomImage = false;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ
            if (syncMode === 'online' && firestore) {
                await savePropertiesToFirebase();
            }
            saveLocalData();
            
            selectPropertyForEditing(currentlyEditingProperty.id);
            
            showNotification('–í—Å–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —É–¥–∞–ª–µ–Ω—ã', 'warning');
            updateAdminStats();
            
            if (!document.getElementById('mainPage').classList.contains('hidden')) {
                applyFilters();
            }
        }

        async function savePropertyChanges() {
            if (!currentlyEditingProperty) return;
            
            const title = document.getElementById('editPropertyTitle').value.trim();
            const type = document.getElementById('editPropertyType').value;
            const district = document.getElementById('editPropertyDistrict').value;
            const price = parseInt(document.getElementById('editPropertyPrice').value);
            const rooms = document.getElementById('editPropertyRooms').value.trim();
            const size = document.getElementById('editPropertySize').value.trim();
            const rental = parseInt(document.getElementById('editPropertyRental').value);
            const description = document.getElementById('editPropertyDescription').value.trim();
            
            if (!title || !price || !rooms || !size || !rental || !description) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            if (price < 0 || rental < 0) {
                showNotification('–¶–µ–Ω–∞ –∏ –¥–æ—Ö–æ–¥ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏', 'error');
                return;
            }
            
            currentlyEditingProperty.title = title;
            currentlyEditingProperty.type = type;
            currentlyEditingProperty.district = district;
            currentlyEditingProperty.price = price;
            currentlyEditingProperty.rooms = rooms;
            currentlyEditingProperty.size = size;
            currentlyEditingProperty.rentalIncome = rental;
            currentlyEditingProperty.description = description;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ
            if (syncMode === 'online' && firestore) {
                await savePropertiesToFirebase();
            }
            saveLocalData();
            
            renderPropertiesManagement();
            selectPropertyForEditing(currentlyEditingProperty.id);
            
            showNotification('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
            
            if (!document.getElementById('mainPage').classList.contains('hidden')) {
                applyFilters();
            }
            
            if (!document.getElementById('myPropertiesPage').classList.contains('hidden')) {
                renderOwnedProperties();
            }
        }

        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        function exportAllData() {
            downloadBackup();
        }

        function importAllData() {
            importUserData();
        }

        function addDemoUsers() {
            const newDemoUsers = [
                {
                    id: Date.now().toString(),
                    firstName: '–†–æ–±–µ—Ä—Ç',
                    lastName: '–î—Ä–µ–π–∫',
                    username: 'rdrake',
                    password: '123456',
                    balance: 150000,
                    properties: [],
                    isAdmin: false,
                    registrationDate: new Date().toISOString()
                },
                {
                    id: (Date.now() + 1).toString(),
                    firstName: '–õ–∏–∑–∞',
                    lastName: '–ì–∞—Ä—Å–∏—è',
                    username: 'lgarcia',
                    password: '123456',
                    balance: 180000,
                    properties: [],
                    isAdmin: false,
                    registrationDate: new Date().toISOString()
                }
            ];
            
            users.push(...newDemoUsers);
            saveLocalData();
            
            if (syncMode === 'online' && firestore) {
                newDemoUsers.forEach(user => saveUserToFirebase(user));
            }
            
            showNotification('–î–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã', 'success');
            renderUsersList();
            updateAdminStats();
        }

        function addDefaultPhotos() {
            showNotification('–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç –≤ —Ä–∞–∑–¥–µ–ª–µ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é" –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞', 'info');
        }

        async function resetDemoData() {
            if (confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —Å–±—Ä–æ—Å–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –∫ –¥–µ–º–æ-—Å–æ—Å—Ç–æ—è–Ω–∏—é. –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                // –û—á–∏—â–∞–µ–º Firebase
                if (syncMode === 'online' && firestore) {
                    await clearFirebaseData();
                }
                
                // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                localStorage.clear();
                users = [];
                currentUser = null;
                transactions = [];
                properties = JSON.parse(JSON.stringify(demoPropertiesData));
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                saveLocalData();
                
                showNotification('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã', 'warning');
                setTimeout(() => {
                    location.reload();
                }, 1000);
            }
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        
        document.getElementById('priceSlider').addEventListener('input', function() {
            document.getElementById('maxPrice').textContent = `$${parseInt(this.value).toLocaleString()}`;
        });

        // –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∫–ª–∞–≤–∏—à
        let secretKeySequence = [];
        const SECRET_KEY_COMBO = ['b', 'l', 'u', 'e', 'a', 'd', 'm', 'i', 'n'];
        
        document.addEventListener('keydown', function(event) {
            secretKeySequence.push(event.key.toLowerCase());
            
            if (secretKeySequence.length > SECRET_KEY_COMBO.length) {
                secretKeySequence.shift();
            }
            
            if (secretKeySequence.join('') === SECRET_KEY_COMBO.join('')) {
                if (currentUser && currentUser.isAdmin) {
                    showAdminPanel();
                    showNotification('–°–µ–∫—Ä–µ—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!', 'success');
                }
                secretKeySequence = [];
            }
            
            if (window.location.hash === '#admin' && currentUser && currentUser.isAdmin) {
                showAdminPanel();
                window.location.hash = '';
            }
        });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –æ–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
        window.addEventListener('online', () => {
            isOnline = true;
            if (syncMode === 'online' && !firestore) {
                initializeFirebase();
            }
            showNotification('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
        });
        
        window.addEventListener('offline', () => {
            isOnline = false;
            updateSyncStatus('error', '–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            showNotification('–í—ã –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ', 'warning');
        });

        // ==================== –ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´ ====================
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeSystem();
            
            window.addEventListener('click', (event) => {
                const modal = document.getElementById('purchaseModal');
                if (event.target === modal) {
                    closeModal();
                }
            });
            
            document.getElementById('loginPassword')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') login();
            });
            
            document.getElementById('regConfirmPassword')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') register();
            });
            
            // –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª–∏–∫ –ø–æ –ª–æ–≥–æ—Ç–∏–ø—É (5 —Ä–∞–∑) –¥–ª—è –∞–¥–º–∏–Ω–∞
            let logoClickCount = 0;
            let logoClickTimer;
            
            document.querySelector('.logo').addEventListener('click', function() {
                logoClickCount++;
                
                if (logoClickTimer) {
                    clearTimeout(logoClickTimer);
                }
                
                logoClickTimer = setTimeout(() => {
                    logoClickCount = 0;
                }, 2000);
                
                if (logoClickCount === 5 && currentUser && currentUser.isAdmin) {
                    showAdminPanel();
                    logoClickCount = 0;
                }
            });
        });
    </script>
</body>
</html>